<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

## createDataBase

It creates a database with the name provided as an argument

### Parameters

*   `databaseName` **[string][1]** The name of the database to create.

Returns **[Promise][2]<[boolean][3]>** A promise which helps to know if createDataBase is successful

## deleteDataBase

It deletes a database with the given name

### Parameters

*   `databaseName` **[string][1]** The name of the database to be created.

Returns **[Promise][2]<[boolean][3]>** A promise which helps to know if database delete is successful

## init

This function helps to initialize MySql Client
This function should be called before calling any other functions in this library

Best practice is to `import @aicore/libcommonutils` and call `getMySqlConfigs()` api to read values from of configs
from environment variables.

### Parameters

*   `config` **[Object][4]** config to configure MySQL

    *   `config.host` **[string][1]** mysql database hostname
    *   `config.port` **[string][1]** port number of mysql db
    *   `config.user` **[string][1]** username of database
    *   `config.password` **[string][1]** password of database username

### Examples

Sample config

```javascript
const config = {
   "host": "localhost",
   "port": "3306",
   "user" : "root",
   "password": "1234"
 };
```

Sample initialization code

```javascript
// set  following  environment variables to access database securely
// set MY_SQL_SERVER for mysql server
// set MY_SQL_SERVER_PORT to set server port
// set MY_SQL_USER to specify database user
// set MY_SQL_PASSWORD to set mysql password

import {getMySqlConfigs} from "@aicore/libcommonutils";

const configs = getMySqlConfigs();
init(configs)
```

Returns **[boolean][3]** true if connection is successful false otherwise*

## close

This function helps to close the database connection

Returns **void**&#x20;

## \_isValidTableName

It checks if the nameSpace is a valid table name

### Parameters

*   `nameSpace` **[string][1]** The name of the table.

Returns **[boolean][3]** A boolean value.

## \_isValidJsonField

It checks if the field is a string and if it's length is less than or equal to 63 characters and if it matches the
regular expression `/^[a-zA-Z0-9_]+$/`

### Parameters

*   `field` **[String][1]** The field name to be validated.

Returns **[boolean][3]** A boolean value.

## \_isValidPrimaryKey

Returns true if the given key is a string of length greater than zero and less than or equal to the maximum size of a
primary key.

### Parameters

*   `key` **[string][1]** The primary key of the item to be retrieved.

Returns **[boolean][3]** A boolean value.

## createTable

It creates a table in the database with the name provided as the parameter

we have simplified our database schema, for us, our database has only two columns

1.  `primary key` column, which is a varchar(255)
2.  `JSON` column, which stores values corresponding to the primary key as `JSON`
    using this approach will simplify our database design by delegating the handling of the semantics of
    data to the application.To speed up any query, we have provided an option to add a secondary index
    for JSON fields using `createIndexForJsonField` api.

### Parameters

*   `tableName` **[string][1]** name of table to create

### Examples

How to use this function?

```javascript
import {getMySqlConfigs} from "@aicore/libcommonutils";

const configs = getMySqlConfigs();
init(configs)
const tableName = 'customer';
try {
  await createTable(tableName);
} catch(e){
    console.error(JSON.stringify(e));
}
```

Returns **[Promise][2]** returns a `Promise` await on `Promise` to get status of `createTable`
`on success` await will return `true`. `on failure` await will throw an `exception`.

## put

It takes a table name and a document and then inserts the document into the database.

### Parameters

*   `tableName` **[string][1]** The name of the table in which you want to store the data.
*   `document` **[Object][4]** The JSON string that you want to store in the database.

### Examples

Sample code

```javascript
try {
      const primaryKey = 'bob';
      const tableName = 'customers;
      const document = {
          'lastName': 'Alice',
          'Age': 100,
          'active': true
      };
      await put(tableName, document);
  } catch (e) {
      console.error(JSON.stringify(e));
 }
```

Returns **[Promise][2]** A promise on resolving the promise will give documentID throws an exception
otherwise. DocumentId is an alphanumeric string of length 128

## createDocumentId

It generates a random string of 16 hexadecimal characters
When converting hexadecimal to string. The generated string will contain 32 characters

Returns **[string][1]** A random string of hexadecimal characters.

## deleteKey

It deletes a document from the database based on the document id

### Parameters

*   `tableName` **[string][1]** The name of the table in which the key is to be deleted.
*   `documentID` **[string][1]** document id to be deleted

### Examples

Sample code

```javascript
const tableName = 'customers';
const documentID = '123456';
try {
   await deleteKey(tableName, documentID);
} catch(e) {
   console.error(JSON.stringify(e));
}
```

Returns **[Promise][2]** A promise `resolve` promise to get status of delete. promise will resolve to true
for success and  throws an exception for failure.

## get

It takes in a table name and documentId, and returns a promise that resolves to the document

### Parameters

*   `tableName` **[string][1]** The name of the table in which the data is stored.
*   `documentID` **[string][1]** The primary key of the row you want to get.

### Examples

sample code

```javascript
const tableName = 'customers';
const documentID = '12345';
try {
    const results = await get(tableName, documentID);
    console.log(JSON.stringify(result));
} catch(e){
    console.error(JSON.stringify(e));
}
```

Returns **[Promise][2]** A promise on resolve promise to get the value stored for documentID

## \_queryScanBuilder

It takes a JSON object and returns a SQL query and an array of values to be used in a prepared statement

### Parameters

*   `subQueryObject` **[Object][4]** This is the object that you want to query.
*   `parentKey` **[string][1]?** This is the parent key of the current object. (optional, default `""`)

Returns **[Object][4]** An object with two properties: getQuery and valArray.

## \_prepareQueryForScan

It takes a table name and a query object and returns a query string and an array of values to be used in a prepared
statement

### Parameters

*   `tableName` **[string][1]** The name of the table to query.
*   `queryObject` **[Object][4]** The query object that you want to run.

Returns **[Object][4]** An object with two properties: getQuery and valArray.

## getFromNonIndex

It takes a table name and a query object, and returns a promise that resolves to the
array of matched documents.
`NB: this api will not detect boolean fields while scanning`
This query is doing database scan. using this query frequently can degrade database performance. if this query
is more frequent consider creating index and use `getFromIndex` API
NB: This query will return only 1000 entries.

### Parameters

*   `tableName` **[string][1]** The name of the table you want to query.
*   `queryObject` **[Object][4]** This is the object that you want to query. (optional, default `{}`)

### Examples

sample code

```javascript
const tableName = 'customers';
const queryObject = {
            'lastName': 'Alice',
            'Age': 100
        };
try {
    const scanResults = await getFromNonIndex(tableName, queryObject);
    console.log(JSON.stringify(scanResults));
} catch (e){
    console.error(JSON.stringify(e));
}
```

Returns **[Promise][2]** A promise; on promise resolution returns array of  matched documents. if there are
no match returns empty array

## deleteTable

It deletes a table from the database

### Parameters

*   `tableName` **[string][1]** The name of the table to be deleted.

### Examples

Sample code

```javascript
const tableName = 'customer';
try{
  await deleteTable(tableName);
} catch(e){
    console.error(JSON.stringify(e));
}
```

Returns **[Promise][2]** A promise that will resolve to true if the table is deleted, or reject with an error
if the table is not deleted.

## \_buildCreateJsonColumQuery

\_buildCreateJsonColumQuery(tableName, nameOfJsonColumn, jsonField, dataTypeOfNewColumn, isNotNull, isUnique)

The function takes the following parameters:

*   tableName - the name of the table to add the column to
*   nameOfJsonColumn - the name of the new column
*   jsonField - the name of the field in the JSON column to extract
*   dataTypeOfNewColumn - the data type of the new column
*   isNotNull - a boolean value indicating whether the new column should be nullable
*   isUnique - a boolean value indicating whether the new column should be unique

### Parameters

*   `tableName` **[string][1]** The name of the table you want to add the column to.
*   `nameOfJsonColumn` **[string][1]** The name of the new column that will be created.
*   `jsonField` **[string][1]** The field in the JSON object that you want to extract.
*   `dataTypeOfNewColumn` **[string][1]** This is the data type of the new column.
*   `isNotNull` **[boolean][3]** If the new column should be NOT NULL
*   `isUnique` **[boolean][3]** If true, the new column will be a unique key.

Returns **[string][1]** A string that is a query to add a column to a table.

## \_buildCreateIndexQuery

It takes a table name, a json field name, and a boolean value indicating whether the index should be unique or not,
and returns a string containing the SQL query to create the index

### Parameters

*   `tableName` **[string][1]** The name of the table to create the index on.
*   `jsonField` **[string][1]** The name of the JSON field that you want to index.
*   `isUnique` **[boolean][3]** If true, the index will be unique.

Returns **[string][1]** A string that is a query to create an index on a table.

## \_createIndex

It creates an index on the JSON field in the table

### Parameters

*   `resolve` **[function][5]** A function that is called when the promise is resolved.
*   `reject` **[function][5]** A function that will be called if the promise is rejected.
*   `tableName` **[string][1]** The name of the table to create the index on
*   `jsonField` **[string][1]** The JSON field that you want to create an index on.
*   `isUnique` **[boolean][3]** true if the index is unique, false otherwise

Returns **void** NB `private function exporting this for testing`

## \_isJsonField

It checks if the jsonField is a valid json field.

### Parameters

*   `jsonField` **[string][1]** The JSON field to be queried.

Returns **[boolean][3]** if its valid json field false otherwise

## createIndexForJsonField

It creates a new column in the table for the JSON field and then creates an index on that column.
`NB: this will not work with boolean fields`

### Parameters

*   `tableName` **[string][1]** The name of the table in which you want to create the index.
*   `jsonField` **[string][1]** The name of the field in the JSON object that you want to index.
*   `dataTypeOfNewColumn` **[string][1]** This is the data type of the new column that will be created.
    visit [https://dev.mysql.com/doc/refman/8.0/en/data-types.html][6] to know all supported data types
*   `isUnique` **[boolean][3]** If true, the json filed has to be unique for creating index. (optional, default `false`)
*   `isNotNull` **[boolean][3]** If true, the column will be created with NOT NULL constraint. (optional, default `false`)

### Examples

Sample code

```javascript
const tableName = 'customers';
let jsonfield = 'lastName';
// supported data types can be found on https://dev.mysql.com/doc/refman/8.0/en/data-types.html
let dataTypeOfNewColumn = 'VARCHAR(50)';
let isUnique = false;
try{
     await createIndexForJsonField(tableName jsonfield, dataTypeOfNewColumn, isUnique);
     jsonfield = 'Age';
     dataTypeOfNewColumn = 'INT';
     isUnique = false;

     await createIndexForJsonField(tableName, nameOfJsonColumn, jsonfield, dataTypeOfNewColumn, isUnique);
} catch (e){
     console.error(JSON.stringify(e));
}
```

Returns **[Promise][2]** A promise

## \_prepareQueryForNestedObject

It takes a nested object and returns a query string and an array of values

### Parameters

*   `subQueryObject` **[Object][4]** This is the object that you want to convert to a query.
*   `parentKey` **[string][1]?** This is the key of the parent object. (optional, default `""`)

Returns **[Object][4]** An object with two properties, getQuery and valArray.

## \_prepareQueryOfIndexSearch

It takes a table name and a query object and returns a query string and an array of values

### Parameters

*   `tableName` **[string][1]** The name of the table in which the data is stored.
*   `queryObject` **[Object][4]** The object that you want to search for.

## \_queryIndex

\_queryIndex() is a function that takes a queryParams object, a resolve function, and a reject function as parameters.
It then executes the query in the queryParams object, and if the query is successful, it returns the results of
the query to the resolve function. If the query is unsuccessful, it returns the error to the reject function

### Parameters

*   `queryParams` **[Object][4]** This is an object that contains the query and the values to be used in the query.
*   `resolve` **[Function][5]** a function that takes a single argument, which is the result of the query.
*   `reject` **[Function][5]** a function that will be called if the query fails.

Returns **[Array][7]** An array of objects

## getFromIndex

It takes a table name, a column name, and a query object, and returns a promise that resolves to an array of objects

### Parameters

*   `tableName` **[string][1]** The name of the table in which the data is stored.
*   `queryObject` **[Object][4]** This is the object that you want to search for.

### Examples

Sample code

```javascript
const tableName = 'customer';
const queryObject = {
            'lastName': 'Alice',
            'Age': 100
            };
try {
     const queryResults = await getFromIndex(tableName, queryObject);
     console.log(JSON.stringify(queryResults));
} catch (e) {
     console.error(JSON.stringify(e));
}
```

Returns **[Promise][2]** A promise; on promise resolution returns array of matched  values in json column. if there are
no matches returns empty array. if there are any errors will throw an exception

## update

It updates the document in the database
This api will overwrite current document with new document

### Parameters

*   `tableName`  The name of the table to update.
*   `documentId`  The primary key of the document to be updated.
*   `document`  The document to be inserted.

### Examples

Sample code

```javascript
const docId = 1234;
const document = {
            'lastName': 'Alice1',
            'Age': 140,
            'active': true
             };
try{
     await update(tableName, docId, document);
} catch(e){
    console.error(JSON.stringify(e));
}
```

Returns **[Promise][2]** A promise on resolving promise will get documentId

## mathAdd

It increments the value of a field in a JSON column in a MySQL table

### Parameters

*   `tableName` **[string][1]** The name of the table in which the document is stored.
*   `documentId` **[string][1]** The primary key of the document you want to update.
*   `jsonFieldsIncrements` **[Object][4]** This is a JSON object that contains the fields to be incremented and the
    value by which they should be incremented.

Returns **[Promise][2]<[boolean][3]>** A promise

[1]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[2]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[3]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[4]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[5]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[6]: https://dev.mysql.com/doc/refman/8.0/en/data-types.html

[7]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array
